<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>签到情况</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
    <style type="text/css">
        .layui-form-select dl dd:hover {
            background-color: #1E9FFF;
            color: #1E9FFF
        }
    </style>
</head>
<body id="body_whole">

    <div class="layui-tab layui-tab-card">
        <ul class="layui-tab-title">
            <li class="layui-this">总览</li>
            <li>第一周</li>
            <li>第二周</li>
            <li>第三周</li>
        </ul>
        <div class="layui-tab-content" style="">
            <div class="layui-tab-item layui-show">
                <div>
                    <div id="weekly_check_record_up">
                    </div>
                    <div id="weekly_check_record">
                    </div>
                </div>
                <div id="example_echarts_0" style="width: 500px;height:400px;"></div>
            </div>
            <div class="layui-tab-item">
                <div id="example_echarts_1" style="width: 500px;height:400px;"></div>
            </div>
            <div class="layui-tab-item">
                <div id="example_echarts_2" style="width: 500px;height:400px;"></div>
            </div>
            <div class="layui-tab-item layui-show">
                <div id="example_echarts_3" style="width: 500px;height:400px;"></div>
            </div>
        </div>
    </div>

    <script src="incubator-echarts-4.2.1/dist/echarts.min.js"></script>
    <script src="layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript">

        document.getElementById("weekly_check_record_up").innerHTML += '<div style="width:85px; margin-right:10px; float:left;">One Week</div>';
        for (var i = 7; i < 22; i++) {
            if(i < 10)
                document.getElementById("weekly_check_record_up").innerHTML += '<div style="width:56px;float:left;text-align:left;">0' + i + ':00</div>';
            else
                document.getElementById("weekly_check_record_up").innerHTML += '<div style="width:56px;float:left;text-align:left;">' + i + ':00</div>';
        }
        document.getElementById("weekly_check_record_up").innerHTML += '<div style="float:left;text-align:left;">22:0</div>';
        document.getElementById("weekly_check_record_up").innerHTML += '<div>0</div>';
        //document.getElementById("weekly_check_record").innerHTML += '<div style="width:100px; float:left; margin-right:10px;">2019-07-02</div>'
        //for (var i = 0; i < 60; i++) {
        //    if (i % 4 == 0) {
        //        document.getElementById("weekly_check_record").innerHTML += '<div style="width:10px; height:10px; background-color:#1E9FFF;margin:1px; float:left; border: 1px solid #000;"></div>'
        //    }
        //    else {
        //        document.getElementById("weekly_check_record").innerHTML += '<div style="width:12px; height:12px; background-color:#1E9FFF;margin:1px; float:left;"></div>'
        //    }
        //}
    </script>
    <script type="text/javascript">
        //获取传参
        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
        var t_param = GetRequest();
        console.log(t_param);

        var user_id = t_param[`user_id`]
            , user_authority = t_param[`user_authority`]
            , target_id = t_param[`user_id`]
            , target_authority = t_param[`user_authority`]
            , target_pt_id = t_param[`target_pt_id`];

        var date_now = new Date();
        var year_now = date_now.getFullYear()
            , month_now = date_now.getMonth() + 1
            , day_now = date_now.getDay()
            , hour_now = date_now.getHours()
            , min_now = date_now.getMinutes()
            , sec_now = date_now.getSeconds();

        console.log(date_now)
        console.log(year_now)
        console.log(month_now)
        console.log(day_now)
        console.log(hour_now)
        console.log(min_now)
        console.log(sec_now)

        layui.use(['element', 'jquery'], function () {
            var $ = layui.jquery
                , element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

            $('.site-demo-active').on('click', function () {
                var othis = $(this), type = othis.data('type');
                active[type] ? active[type].call(this, othis) : '';
            });

            $.ajax({
                type: "POST",
                url: "http://localhost:8080/GetSigninByStudentServlet",
                async: true,
                data: JSON.stringify({
                    "reqId": "",
                    "reqParam": {
                        "id": target_id,
                        "practiceId": target_pt_id
                    }
                }),
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    var last_t = -1;
                    var temp = "";
                    var done = false;
                    var scanned = false;
                    var index = 0;
                    var str = ""
                        , strs = []
                        , temp_compare = 0.0;

                    for (var i = 0; i < 7; i++) {
                        temp += '<div style="width:100px; float:left; margin-right:10px;">' + res.resData[i].date + '</div>'

                        for (var j = 0; j < res.resData[i].signins.length; j++) {
                            str = (res.resData[i].signins[j].dateTime.split(" "))[1];
                            strs = str.split(":");
                            temp_compare = (parseFloat(strs[0]) + parseFloat(strs[1]) / 60) * 4;
                            var temp_compare_int = parseInt(temp_compare);
                            console.log(strs)
                            console.log(temp_compare)
                            console.log(temp_compare_int)
                        }

                        //for (var j = 0; j < 60; j++) {
                        //    if (j % 4 == 0) {
                        //        temp += '<div style="width:10px; height:10px; background-color:#1E9FFF;margin:1px; float:left; border: 1px solid #000;"></div>'
                        //    }
                        //    else {
                        //        temp += '<div style="width:12px; height:12px; background-color:#1E9FFF;margin:1px; float:left;"></div>'
                        //    }
                        //}
                        temp += '<div style="font-style:1px;">.</div>'
                    }
                    document.getElementById("weekly_check_record").innerHTML += temp;
                },
                error: function (res) {
                    console.log("error");
                    console.log(res);
                }
            });

            function getWeek(dateString) {
                var date;
                if (isNull(dateString)) {
                    date = new Date();
                } else {
                    var dateArray = dateString.split("-");
                    date = new Date(dateArray[0], parseInt(dateArray[1] - 1), dateArray[2]);
                }
                //var weeks = new Array("日", "一", "二", "三", "四", "五", "六");
                //return "星期" + weeks[date.getDay()];
                return "星期" + "日一二三四五六".charAt(date.getDay());
            };
        });
    </script>
    <script type="text/javascript">
        for (var n = 0; n <= 3; n++) {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('example_echarts_' + n));

            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: '工作时长'
                },
                tooltip: {},
                legend: {
                    data: ['时长']
                },
                xAxis: {
                    data: ["Mon", "Tue", "Wed", "Thue", "Fri", "Sat", "Sun"]
                },
                yAxis: {},
                series: [{
                    name: '时长',
                    type: 'bar',
                    data: [5, 20, 36, 10, 10, 20, 40]
                }]
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }
    </script>
</body>
</html>