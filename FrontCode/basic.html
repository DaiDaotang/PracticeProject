<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>???</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css" media="all">

    <style type="text/css">
        .layui-form-select dl dd:hover {
            background-color: #1E9FFF;
            color: #d4dadb
        }
        .test {
            border: 1px solid #000;
        }
    </style>
</head>
<body id="body_whole">

    <ul class="layui-nav" style="position:fixed; width:100%; right:0px;">
        <li class="layui-nav-item" lay-unselect="" style="position:absolute; right:30px;" id="me">
            <a href="javascript:;" style="font-size:28px;"><img src="" class="layui-nav-img" style="width: 28px; height: 28px;" id="user_hd_img">Me</a>
            <dl class="layui-nav-child">
                <dd><a id="user_homepage_a" href="">我的主页</a></dd>
                <dd><a id="change_info_a" href="">修改信息</a></dd>
                <dd><a id="safety_info_a" href="safety_info.html">安全管理</a></dd>
                <dd><a id="quit_a" href="login.html">退出登录</a></dd>
            </dl>
        </li>
    </ul>

    <ins class="adsbygoogle" style="display:inline-block;width:970px; height: 0;" data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins>

    <div style="width: auto; height: 100%; margin: 50px 150px 50px 150px;">
    </div>

    <script src="layui/layui.js" charset="utf-8"></script>
    <script>
        //获取传参
        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
        var t_param = GetRequest();
        console.log(t_param);

        //共有变量
        var user_hd_img = ""
            , user_id = parseInt(t_param[`user_id`])
            , user_authority = t_param[`user_authority`];

        //共有URL
        var HomepageURL = ""
            , QuitURL = "login.html"
            , ChangeInfoURL = "login.html"
            , SafetyURL = "safety_info.html"
            , GetStudentServletURL = "http://localhost:8080/GetStudentInformationServlet"
            , GetCompanyTeacherServletURL = "http://localhost:8080/GetCompanyTeacherInformationServlet"
            , GetSchoolTeacherServletURL = "http://localhost:8080/GetSchoolTeacherInformationServlet"
            , GetCompanyServletURL = "http://localhost:8080/GetCompanyInformationServlet"
            , GetAnyUserServlet = ""
            , GetHeadImgURL = "http://localhost:8080/DownloadServlet?head=";

        //获取个人信息
        layui.use(['jquery','layer'], function () {
            var $ = layui.jquery
                , layer = layui.layer;

            //获取本人信息
            switch (user_authority) {
                case "Student":
                    GetAnyUserServlet = GetStudentServletURL;
                    break;
                case "Teacher":
                    GetAnyUserServlet = GetCompanyTeacherServletURL
                    break;
                case "School":
                    GetAnyUserServlet = GetSchoolTeacherServletURL
                    break;
                case "Company":
                    GetAnyUserServlet = GetCompanyServletURL
                    break;
            }
            $.ajax({
                type: "POST",
                url: GetAnyUserServlet,
                async: true,
                data: JSON.stringify({
                    "reqId": "",
                    "reqParam": user_id
                }),
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    user_hd_img = res.resData.head ? res.resData.head : "";
                    document.getElementById("user_hd_img").src = (user_hd_img == "" ? "./img/defaultHead.jpg" : GetHeadImgURL + user_hd_img);
                },
            });
        });

        //element区
        layui.use('element', function () {
            var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

            //监听导航点击
            element.on('nav(me)', function (elem) {
                console.log(elem)
                layer.msg(elem.text());
            });
        });

        //基础区
        switch (user_authority) {
            case "Student":
                HomepageURL = "homepage_student.html?user_id=" + user_id + "&user_authority=Student&target_id=" + user_id + "&target_authority=Student"
                break;
            case "Teacher":
                HomepageURL = "homepage_company_teacher.html?user_id=" + user_id + "&user_authority=Teacher&target_id=" + user_id + "&target_authority=Teacher"
                break;
            case "School":
                HomepageURL = "homepage_school_teacher.html?user_id=" + user_id + "&user_authority=School&target_id=" + user_id + "&target_authority=School"
                break;
            case "Company":
                break;
            default:
                HomepageURL = "login.html"
                break;
        }
        document.getElementById("user_homepage_a").href = HomepageURL;
        document.getElementById("change_info_a").href = ChangeInfoURL;
        document.getElementById("safety_info_a").href = SafetyURL;
        document.getElementById("quit_a").href = QuitURL;
    </script>
</body>
</html>