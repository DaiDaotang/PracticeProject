<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>学生主页</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css" media="all">

    <style type="text/css">
        .layui-form-select dl dd:hover {
            background-color: #1E9FFF;
            color:#d4dadb
        }

        #body_whole {
            height:100%;
            background: -webkit-linear-gradient(#2988d6, #bfddf8, #4df74b); /* Safari 5.1 - 6.0 */
            background: -o-linear-gradient(#2988d6, #bfddf8, #4df74b); /* Opera 11.1 - 12.0 */
            background: -moz-linear-gradient(#2988d6, #bfddf8, #4df74b); /* Firefox 3.6 - 15 */
            background: linear-gradient(#2988d6, #bfddf8, #4df74b); /* 标准的语法（必须放在最后） */
        }
    </style>
</head>
<body id="body_whole">

    <ul class="layui-nav" style="position:fixed; width:100%; right:0px;">
        <li class="layui-nav-item" lay-unselect="" style="position:absolute; right:30px;" id="me">
            <a href="javascript:;" style="font-size:28px;"><img src="" class="layui-nav-img" style="width: 28px; height: 28px;" id="user_hd_img">Me</a>
            <dl class="layui-nav-child">
                <dd><a id="my_homepage_a" href="">我的主页</a></dd>
                <dd><a id="change_info_a" href="">修改信息</a></dd>
                <dd><a id="safety_info_a" href="safety_info.html">安全管理</a></dd>
                <dd><a id="quit_a" href="login.html">退出登录</a></dd>
            </dl>
        </li>
    </ul>

    <ins class="adsbygoogle" style="display:inline-block;width:970px;" data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins>

    <div style="width: auto; height: 100%; margin: 0 150px 80px 150px;">
        <img id="target_head_img" style="width:150px; height:150px; position:absolute; left: 210px; top: 190px; border-radius: 75px;" />

        <div style="background-color:#c9c9c9; width: auto; height: 230px; margin-top: 50px; border-top-left-radius: 30px; border-top-right-radius: 30px;">
            <div id="information" style="position:absolute; left: 420px; top: 190px; width:auto">
                <span id="username" style="font-size:45px; text-align:left; width:400px; font-family:FangSong"></span>
                <span id="gender" style="font-size:40px;"></span>
            </div>

            <div style="position:absolute; right:210px; top: 255px; width:auto; font-size: 30px;">
                <span><a id="school_a" href="" target="_blank" title="学校主页"></a></span>
                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="major" href="" target="_blank" title="百度百科"></a></span>
                <span id="grade">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            </div>

            <div class="layui-form-item" id="check_div">
                <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="checkin" id="checkin" style="width:150px; font-size:22px; position: absolute; top: 110px; right: 200px;">Check In</button>
                <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="checkrecord" id="checkrecord" style="width:150px;  font-size:16px; position: absolute; top: 160px; right: 200px; background-color:#2988d6">Check Record</button>
            </div>
        </div>

        <div style="background-color:#fff; width: auto; height: auto; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; border: 1px solid #FFF;">

            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px; ">
                <legend style="font-size:24px;">团队&项目</legend>
            </fieldset>
            <div style="width: auto; height: 100px; margin: 0 20px 50px 20px; border: 1px solid #e7f6f7; border-radius: 10px; background-color:#e7f6f7">
                <div class="layui-row" style="height:100px;">
                    <div class="layui-col-md6" style="height:100px;">
                        <div class="grid-demo grid-demo-bg1" style="height:auto; margin: 20px 0 20px 20px;">
                            <i class="layui-icon layui-icon-group" style="height:100px; color: #1E9FFF; font-size:50px; margin-right: 20px;"></i>
                            <a id="group_a" href="" target="_blank" title="团队主页">
                                <span style="font-size: 40px; font-family:STXingkai" id="group_name"></span>
                            </a>
                        </div>
                    </div>
                    <div class="layui-col-md6" style="height:100px;">
                        <div class="grid-demo grid-demo-bg1" style="height:auto; margin: 20px 0 20px 20px;">
                            <i class="layui-icon layui-icon-tabs" style="height:100px; color: #1E9FFF; font-size:50px; margin-right: 20px;"></i>
                            <a id="item_a" href="" target="_blank" title="项目介绍页面">
                                <span style="font-size: 40px; font-family:STXingkai" id="item_name"></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 40px; ">
                <legend style="font-size:24px;">日志</legend>
            </fieldset>
            <div style="width: auto; height: auto; margin: 0 20px 20px 20px; border: 1px solid #e7f6f7; border-radius: 10px; background-color:#e7f6f7">
                <div style="width:auto; height: auto; margin: 20px 40px;">
                    <form class="layui-form" action="" lay-filter="diary_form" id="diary_form">
                        <div class="layui-form-item" style="display:inline-flex; width: 100%;">
                            <input type="text" name="search_diary_input" lay-filter="search_diary_input" id="search_diary_input" placeholder="搜索..." autocomplete="off" class="layui-input" style="width:40%; border-radius: 20px;">
                            <input type="text" class="layui-input" name="search_diary_data" id="search_diary_data" lay-filter="search_diary_data" placeholder="Year-Month-Day" style="width:20%; margin-left:20px; border-radius: 20px;">
                            <button class="layui-btn" lay-submit="" lay-filter="search_diary_btn" id="search_diary_btn" style="margin-left:20px; border-radius:20px;">
                                <i class="layui-icon layui-icon-search" style="height:100px; color: #fff; font-size:25px;"></i>
                            </button>
                        </div>
                    </form>
                </div>
                <div style="width:auto; height: auto; margin: 20px 20px;">
                    <ul class="flow-default" id="diary_flow">
                        <li>
                            <div style="width:auto; height: auto; margin: 20px; background-color:#d4dadb; border-radius: 20px; border: 1px solid #d4dadb;">
                                <div style="width:auto; height: auto; margin: 20px; border: 1px solid #000;">
                                    <div class="layui-row" style="height:auto;">
                                        <div class="layui-col-md8" style="height:100px;">
                                            <div class="grid-demo grid-demo-bg1" style="height:auto; margin: 20px 0 20px 20px;">
                                                <span style="font-size:30px;">不忘初心，方得始终</span>
                                                <hr class="layui-bg-blue">
                                            </div>
                                        </div>
                                        <div class="layui-col-md4" style="height:auto; text-align:right;">
                                            <div class="grid-demo grid-demo-bg1" style="margin: 20px;">
                                                <a href="javascript:;" style="font-size:28px;"><span style="font-size:40px;">武大学子</span></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="width:auto; height: auto; margin: 20px; border: 1px solid #000;">
                                    <div class="layui-row" style="height:auto;">
                                        <div class="layui-col-md7" style="height:100px;">
                                            <div class="grid-demo grid-demo-bg1" style="height:auto; margin: 20px 0 20px 20px;">

                                            </div>
                                        </div>
                                        <div class="layui-col-md5" style="height:auto; text-align:right;">
                                            <div class="grid-demo grid-demo-bg1" style="margin: 20px;">
                                                <img src="./img/defaultHead.jpg" style="width: 300px;"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <button style="background:none; border:none; width: auto; height: auto; position:fixed; right: 50px; bottom:50px;" id="turntop">
        <i class="layui-icon layui-icon-top" style="font-size: 70px; color: #000;"></i>
    </button>
    <button class="layui-btn" id="write_diary_btn" style="margin-left: 100px; border-radius:20px; background-color:#ff6a00; position:fixed; right: 50px; bottom:130px;">
        <i class="layui-icon layui-icon-edit" style="height:100px; color: #fff; font-size:35px;"></i>
    </button>

    <script src="layui/layui.js" charset="utf-8"></script>
    <script>
        //获取传参
        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
        var t_param = GetRequest();

        console.log(t_param);

        //变量
        var user_hd_img = "./img/defaultHead.jpg"         //////////
            , user_id = parseInt(t_param[`user_id`])
            , user_authority = t_param[`user_authority`]
            , user_hasChecked = false
            , target_id = parseInt(t_param[`target_id`])
            , target_authority = t_param[`target_authority`]
            , target_name = ""
            , target_gender = ""
            , target_hd_img = "./img/defaultHead.jpg"         //////////
            , target_school_id = -1
            , target_school_name = ""
            , target_grade = ""
            , target_major = ""
            , target_group_id = -1
            , target_group_name = ""
            , target_item_id = -1
            , target_item_name = "";

        //console.log("id=" + target_id + " authority=" + t_param[`authority`])

        var CheckRecordURL = "login.html"
            , GroupURL = "login.html"
            , ItemURL = "login.html"
            , QuitURL = "login.html"
            , ChangeInfoURL = "login.html"
            , SafetyURL = "safety_info.html"
            , SchoolURL = "login.html"
            , CreateGroupURL = "student_create_team.html"
            , WriteDiaryURL = "login.html"
            , GetStudentServletURL = "http://localhost:8080/GetStudentInformationServlet"
            , GetStudentTeamURL = "http://localhost:8080/StudentCheckTeamServlet"
            , CheckInOutURL = "http://localhost:8080/SigninServlet"
            , ChangeHeadURL = "login.html"
            , HomepageURL = "";

        //测试变量
        var test_style = "1px solid #000";

        //form区 + 大区
        layui.use(['form', 'jquery', 'layer'], function () {
            var form = layui.form
                , $ = layui.jquery
                , layer = layui.layer;

            //表单初始赋值
            form.val('diary_form', {
                "search_diary_input": ""
                , "search_diary_data": ""
            })

            //监听搜索
            form.on('submit(search_diary_btn)', function (data) {
                console.log(data.field);
                //layer.msg(JSON.stringify(data.field));
                return false;
            });

            //监听签到
            $(document).on('click', '#checkin', function () {
                $.ajax({
                    type: "POST",
                    url: CheckInOutURL,
                    async: true,
                    data: JSON.stringify({
                        "reqId": "",
                        "reqParam": {
                            "studentId": user_id,
                            "atWork": !user_hasChecked
                        }
                    }),
                    dataType: "json",
                    success: function (res) {
                        if (res.isSuccess) {
                            if (user_hasChecked) {
                                layer.msg('辛苦啦！');
                                user_hasChecked = false;
                                document.getElementById("checkin").innerText = "Check In";
                            } else {
                                layer.msg('签到成功！');
                                user_hasChecked = true;
                                document.getElementById("checkin").innerText = "Check Out";
                            }
                        }
                        else {
                            layer.msg('签到失败！');
                        }
                        console.log(res);
                    }
                });
            });

            //监听签到情况
            $(document).on('click', '#checkrecord', function () {
                layer.open({
                    title: '签到情况',
                    type: 2,
                    area: ["500px", "500px"],
                    content: CheckRecordURL
                });
            });

            //监听写日志
            $(document).on('click', '#write_diary_btn', function () {
                layer.open({
                    title: '签到情况',
                    type: 2,
                    area: ["500px", "500px"],
                    content: WriteDiaryURL
                });
            });

            //监听置顶  
            $(document).on('click', '#turntop', function () {
                document.body.scrollTop = document.documentElement.scrollTop = 0;
            });

            //获取信息
            $.ajax({
                type: "POST",
                url: GetStudentServletURL,
                async: true,
                data: JSON.stringify({
                    "reqId": "",
                    "reqParam": target_id
                }),
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    target_name = res.resData.name
                        , target_gender = res.resData.sex
                        , target_school_name = res.resData.schoolName
                        , target_grade = res.resData.grade
                        , target_major = res.resData.major
                        , target_hd_img = res.resData.head;

                    target_hd_img = "./img/defaultHead.jpg";

                    $.ajax({
                        type: "POST",
                        url: GetStudentTeamURL,
                        async: true,
                        data: JSON.stringify({
                            "reqId": "",
                            "reqParam": target_id
                        }),
                        dataType: "json",
                        success: function (res) {
                            console.log(res);
                            if (res.isSuccess) {
                                target_group_id = res.resData.teamId
                                    , target_group_name = res.resData.teamName
                                    , target_item_id = -1
                                    , target_item_name = "";
                            }
                            else {
                                target_group_id = -1
                                    , target_group_name = ""
                                    , target_item_id = -1
                                    , target_item_name = "";
                            }

                            if (target_id != user_id || target_authority != user_authority) {
                                user_hasChecked = true;
                                document.getElementById("checkin").style.display = "none";
                                document.getElementById("write_diary_btn").style.display = "none";
                            }

                            document.getElementById("target_head_img").src = target_hd_img;
                            document.getElementById("target_head_img").style.border = "1px solid #6e7474";

                            document.getElementById("username").innerText = target_name;
                            document.getElementById("gender").innerHTML = target_gender == "男" ? '<i class="layui-icon layui-icon-male" style="height:100px; color: #1E9FFF; font-size:40px; margin-left: 20px;"></i>' : '<i class="layui-icon layui-icon-female" style="height:100px; color: #fd5087; font-size:40px; margin-left: 20px;"></i>'
                            document.getElementById("school_a").innerText += target_school_name;
                            document.getElementById("major").innerText += target_major;
                            document.getElementById("grade").innerText += target_grade;
                            document.getElementById("major").href = "https://baike.baidu.com/item/" + major;
                            document.getElementById("school_a").href = "https://baike.baidu.com/item/" + target_school_name;

                            document.getElementById("user_hd_img").src = user_hd_img;

                            if (target_group_id != -1) {
                                document.getElementById("group_name").innerText = target_group_name;
                                document.getElementById("group_a").href = GroupURL;
                            }
                            else {
                                document.getElementById("group_name").innerText = "暂无";
                                document.getElementById("item_name").innerText = "暂无";
                                document.getElementById("item_a").href = "javascript:return false;";
                                if (target_authority == user_authority && target_id == user_id) {
                                    document.getElementById("group_a").href = CreateGroupURL + "?user_id=" + user_id;
                                }
                                else {
                                    document.getElementById("group_a").href = "javascript:return false;";
                                }
                            }

                            if (target_item_id != -1) {
                                document.getElementById("item_name").innerText = target_item_name;
                                document.getElementById("item_a").href = ItemURL;
                            }
                            else {
                                document.getElementById("item_name").innerText = "暂无";
                                document.getElementById("item_a").href = "javascript:return false;";
                            }

                        },
                        error: function (res) {
                            console.log("获取团队信息失败");
                            console.log(res);
                        }
                    });
                },
                error: function (res) {
                    console.log("获取用户基本信息失败");
                }
            });
        });

        //element区
        layui.use('element', function () {
            var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

            //监听导航点击
            element.on('nav(me)', function (elem) {
                console.log(elem)
                layer.msg(elem.text());
            });
        });

        //laydate区
        layui.use('laydate', function () {
            var laydate = layui.laydate;

            //执行一个laydate实例
            laydate.render({
                elem: '#search_diary_data'
            });
        });

        //flow区
        layui.use('flow', function () {
            var flow = layui.flow
                , $ = layui.jquery;

            flow.load({
                elem: '#diary_flow' //流加载容器
                , done: function (page, next) { //执行下一页的回调

                    //模拟数据插入
                    setTimeout(function () {
                        var lis = [];
                        for (var i = 0; i < 8; i++) {
                            lis.push('<li><div style="width:auto; height: 200px; margin: 20px; background-color:#d4dadb; border-radius: 20px;"><p>' + ((page - 1) * 8 + i + 1) + '</p></div></li>')
                        }

                        //执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
                        //pages为Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
                        next(lis.join(''), page < 10); //假设总页数为 10
                    }, 300);
                }
            });
        });

        //基础区
        switch (user_authority) {
            case "Student":
                HomepageURL = "homepage_student.html?user_id=" + user_id + "&user_authority=Student&target_id=" + user_id + "&target_authority=Student"
                break;
            case "Teacher":
                HomepageURL = "homepage_company_teacher.html?user_id=" + user_id + "&user_authority=Teacher&target_id=" + user_id + "&target_authority=Teacher"
                break;
            case "School":
                HomepageURL = "homepage_school_teacher.html?user_id=" + user_id + "&user_authority=School&target_id=" + user_id + "&target_authority=School"
                break;
            case "Company":
                break;
        }
        document.getElementById("my_homepage_a").href = HomepageURL;
        document.getElementById("change_info_a").href = ChangeInfoURL;
        document.getElementById("safety_info_a").href = SafetyURL;
        document.getElementById("quit_a").href = QuitURL;
    </script>
</body>
</html>